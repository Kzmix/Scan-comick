---
import BaseLayout from "@/layouts/BaseLayout.astro";
import { getAllSeriesSlugs, getSeriesBySlug } from "@/lib/series";
import genres from "@/data/genres.json";

export async function getStaticPaths() {
  return getAllSeriesSlugs().map((slug) => ({
    params: { slug },
  }));
}

const { slug } = Astro.params;
const series = getSeriesBySlug(slug);

if (!series) {
  throw new Error("Series not found");
}

const canonical = `https://example.com/series/${series.slug}`;
---

<BaseLayout
  title={series.title}
  description={series.description}
  canonical={canonical}
  type="article"
>
  <main class="bg-zinc-950 text-zinc-100">
    <article class="max-w-7xl mx-auto px-4 py-10">

      <!-- HEADER -->
      <header class="grid md:grid-cols-[220px_1fr] gap-6">
        <img
          src={series.cover}
          alt={`Cover komik ${series.title}`}
          width="220"
          height="320"
          loading="eager"
          class="rounded-lg object-cover"
        />

        <div>
          <h1 class="text-2xl md:text-3xl font-bold">
            {series.title}
          </h1>

          {series.altTitle && (
            <p class="mt-1 text-sm text-zinc-400">
              {series.altTitle}
            </p>
          )}

          <div class="mt-3 flex flex-wrap gap-2">
            {series.genres.map((slug) => (
              <a
                href={`/genre/${slug}`}
                class="rounded-full bg-zinc-800 px-3 py-1
                       text-xs text-zinc-300 hover:bg-zinc-700"
              >
                {genres[slug]?.name ?? slug}
              </a>
            ))}
          </div>

          <dl class="mt-4 text-sm text-zinc-400 space-y-1">
            {series.author && (
              <div><dt class="inline">Author:</dt> <dd class="inline">{series.author}</dd></div>
            )}
            {series.status && (
              <div><dt class="inline">Status:</dt> <dd class="inline">{series.status}</dd></div>
            )}
          </dl>
        </div>
      </header>

<div class="mt-6">
  <button
    type="button"
    class="bookmark-btn inline-flex items-center gap-2 rounded-lg
           border border-zinc-700 bg-zinc-900/60
           px-4 py-2 text-sm font-medium text-zinc-300
           hover:bg-zinc-800 transition"
    data-bookmark="toggle"
    data-series-slug={series.slug}
  >
    <span data-bookmark-label>Simpan</span>
  </button>
</div>

      <!-- SYNOPSIS -->
      <section class="mt-8">
        <h2 class="text-lg font-semibold mb-2">Sinopsis</h2>
        <p class="text-zinc-300 leading-relaxed max-w-3xl">
          {series.description}
        </p>
      </section>

      <!-- CHAPTER LIST -->
      <section class="mt-10">
        <h2 class="text-lg font-semibold mb-4">Daftar Chapter</h2>

        <ul class="divide-y divide-zinc-800 max-w-xl">
          {series.chapters.map((ch) => (
            <li class="py-3">
              <a
                href={`/series/${series.slug}/chapter/${ch.number}`}
                class="block hover:text-white"
              >
                Chapter {ch.number}
                {ch.title && ` â€” ${ch.title}`}
              </a>
            </li>
          ))}
        </ul>
      </section>

      <!-- SCHEMA -->
      <script type="application/ld+json">
        {JSON.stringify({
          "@context": "https://schema.org",
          "@type": "ComicSeries",
          name: series.title,
          alternateName: series.altTitle,
          description: series.description,
          author: series.author
            ? { "@type": "Person", name: series.author }
            : undefined,
          genre: series.genres.map(
            (g) => genres[g]?.name ?? g
          ),
          url: canonical,
          image: series.cover,
        })}
      </script>

      <!-- BREADCRUMB -->
      <script type="application/ld+json">
        {JSON.stringify({
          "@context": "https://schema.org",
          "@type": "BreadcrumbList",
          itemListElement: [
            {
              "@type": "ListItem",
              position: 1,
              name: "Home",
              item: "https://example.com",
            },
            {
              "@type": "ListItem",
              position: 2,
              name: series.title,
              item: canonical,
            },
          ],
        })}
      </script>

    </article>
  </main>
</BaseLayout>